{% extends "base.html" %}
{% load static %}

{% block title %}Match Your CV Â· MatchMyCV{% endblock %}

{% block extra_head %}{% endblock %}

{% block content %}
  <main class="min-h-[calc(100vh-8.375rem)] py-12 px-[5%] flex items-center justify-center">
    <div class="w-full max-w-[900px]">
      <!-- Header -->
      <div class="text-center mb-12">
        <h1 class="text-4xl font-bold text-blue-600 leading-tight mb-3 md:text-[2.625rem]">Match Your CV</h1>
        <p class="text-slate-800 text-base md:text-lg leading-relaxed">Find the best job matches for your CV instantly.</p>
      </div>

      <!-- Location -->
      <div class="mb-8">
        <label for="location" class="block text-slate-900 font-semibold text-[17px] mb-3">Location</label>

        <div class="relative">
          <select
            id="location"
            class="w-full px-4 py-3 pr-10 rounded-xl border-2 border-[#bcbcbd] text-[15px] text-slate-700 bg-white outline-none transition
                   focus:border-blue-600 appearance-none"
          >
            <option value="all">All Locations</option>
            <option value="jakarta">Jakarta</option>
            <option value="surabaya">Surabaya</option>
            <option value="bandung">Bandung</option>
            <option value="medan">Medan</option>
            <option value="semarang">Semarang</option>
            <option value="makassar">Makassar</option>
            <option value="yogyakarta">Yogyakarta</option>
            <option value="bali">Bali</option>
            <option value="remote">Remote</option>
          </select>

          <!-- Chevron -->
          <svg class="pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 h-5 w-5 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
            <polyline points="6 9 12 15 18 9" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" />
          </svg>
        </div>
      </div>

      <!-- Upload -->
      <div class="flex flex-col items-center">
        <input type="file" id="cv-upload" accept=".pdf" class="hidden">

        <button
          type="button"
          id="upload-btn"
          onclick="document.getElementById('cv-upload').click()"
          class="inline-flex items-center justify-center rounded-xl bg-blue-600 text-white font-semibold text-xl px-14 py-3 transition
                 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-400"
        >
          Upload CV
        </button>
      </div>

      <!-- File card -->
      <div id="file-card" class="hidden w-full flex items-center justify-center mt-3 mb-3">
        <div class="w-[70%] max-w-[400px] bg-white border-2 border-slate-200 rounded-xl px-5 py-4 flex items-center gap-3 shadow-sm">
          <div class="bg-neutral-600 rounded-lg p-2.5 flex-shrink-0">
            <svg class="w-6 h-6 text-white" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
              <path d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z"/>
            </svg>
          </div>

          <div class="min-w-0 flex-1">
            <div id="display-filename" class="text-slate-900 font-semibold text-sm truncate">My CV.pdf</div>
            <div id="display-filesize" class="text-slate-500 text-xs">3.5 MB</div>
          </div>

          <button
            type="button"
            onclick="removeFile()"
            class="flex items-center justify-center w-7 h-7 rounded-full bg-slate-600 hover:bg-slate-700 transition focus:outline-none"
            aria-label="Remove file"
          >
            <svg class="w-3.5 h-3.5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
      </div>

      <!-- Analyze -->
      <div class="flex flex-col items-center">
        <button
          type="button"
          id="analyze-btn"
          class="hidden inline-flex items-center justify-center rounded-xl bg-blue-600 text-white font-semibold text-xl px-14 py-3 transition
                 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-400"
        >
          Analyze
        </button>
        <p class="text-slate-500 text-sm mt-2">Supported format: PDF (max. 10 MB)</p>
      </div>
    </div>
  </main>
{% endblock %}

{% block extra_js %}
<script>
  (function () {
    const els = {
      fileInput: document.getElementById('cv-upload'),
      uploadBtn: document.getElementById('upload-btn'),
      fileCard: document.getElementById('file-card'),
      analyzeBtn: document.getElementById('analyze-btn'),
      fileName: document.getElementById('display-filename'),
      fileSize: document.getElementById('display-filesize'),
      locationSelect: document.getElementById('location'),
    };

    let uploadedFile = null;

    function show(el) { el.classList.remove('hidden'); }
    function hide(el) { el.classList.add('hidden'); }

    function checkFormValidity() {
      if (uploadedFile) { show(els.analyzeBtn); }
      else { hide(els.analyzeBtn); }
    }

    window.removeFile = function () {
      uploadedFile = null;
      els.fileInput.value = '';
      show(els.uploadBtn);
      hide(els.fileCard);
      hide(els.analyzeBtn);
    };

    els.fileInput.addEventListener('change', function(e) {
      const file = e.target.files?.[0];
      if (!file) return;

      if (file.size > 10 * 1024 * 1024) {
        alert('File size exceeds 10 MB limit');
        return;
      }
      if (file.type !== 'application/pdf') {
        alert('Please upload a PDF file');
        return;
      }

      uploadedFile = file;
      hide(els.uploadBtn);
      show(els.fileCard);
      els.fileName.textContent = file.name;
      els.fileSize.textContent = `${(file.size / 1024 / 1024).toFixed(1)} MB`;
      checkFormValidity();
    });

    els.locationSelect.addEventListener('change', checkFormValidity);

    els.analyzeBtn.addEventListener('click', function() {
      if (!uploadedFile) return;
      // TODO: kirim FormData ke endpoint-mu
      alert('Analyzing your CV...');
    });
  })();
</script>
{% endblock %}
